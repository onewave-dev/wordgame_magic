README (кратко): как работает фильтр и как пользоваться ячейками 0–3
Цель

Собрать валидированный словарь нарицательных существительных (ru), которые:

стоят в И.п. ед.ч. или это pluralia tantum в И.п. мн.ч. (и не имеют формы ед.ч.),

не являются собственными именами и не помечены как архаизмы,

проходят частотный порог (по сумме е/ё) и имеют русскую секцию в Викисловаре.

Базовые зависимости

pymorphy2, wordfreq, requests, tqdm, google.colab (Drive)

Всё объявляется и настраивается в Ячейке 0.
Перед запуском 1–3 всегда выполнить ячейки зависимостей и Ячейку 0.

Логика фильтра
Морфология (pymorphy2)

Проходит слово, если выполнено всё ниже:

NOUN и нарицательное: отбрасываем теги Name, Surn, Patr, Geox, Orgn, Trad, а также Arch.

Форма:

nomn + sing (И.п. ед.ч.) или nomn + plur с Pltm или без sing в лексеме (pluralia tantum).

Несклоняемые (Sgtm/Fixd) учитываются как эквивалент sing.

Лемма по умолчанию — NOUN (лучший разбор леммы не должен быть прилагательным и т.п.).

NUMR-вето: блокируем только если у слова реально есть анализ как NUMR и его score ≥ score(NOUN) − 0.15.
(Жёстко защищает от «сто», но не рубит слова без числительного разбора.)

ADJ-like конкуренты (ADJF/PRTF/PRTS): если их score ≥ score(NOUN) + AMBIGUITY_DELTA (по умолчанию 0.35) — отклоняем.

Частотность (wordfreq)

Е/Ё эквивалентность: считаем частоту обеих орфографий, суммируем в линейной шкале и переводим обратно в Zipf.

Режим частотности переключаемый:

FREQ_MODE="best" — консервативно (основной корпус),

FREQ_MODE="best_or_large" — берём max(best, large) (мягче к редким/заимствованиям).

Порог: ZIPF_FREQ_THRESHOLD = 1.95 (актуально в твоей конфигурации).

Wiktionary (ru)

Слово проходит, если у любой из его е/ё-версий есть секция «Русский».

Запросы к API кэшируются в wiktionary_cache.json.

Что делают ячейки
Ячейка 0 — «Предварительные тесты»

Объявляет все настройки и функции валидации.

Включает переключатель FREQ_MODE.

Тестирует набор слов, печатает подробный отчёт (морфология/частоты/вики).

Доп. отладка для "кит": печать всех разборов и частот best/large.

Ячейка 1 — «Stage-1 (pymorphy2 + ZipfΣ)»

Пробегает весь словарь pymorphy2, нормализует и дедуплицирует формы.

Жёсткий тест позитивов (из набора Ячейки 0): обязаны попасть в Stage-1.

Сохраняет кандидатов Stage-1 (без Wiktionary) в
/content/drive/MyDrive/word_validation/valid_stage1.json.

Ячейка 2 — «Финал (Stage-1 → +Wiktionary)»

Читает valid_stage1.json с Google Drive (поэтому может работать автономно после перезапуска среды, если Ячейка 0 выполнена).

Делает тест позитивов/негативов для финала (учитывая Вики).

Валидирует все Stage-1 кандидаты и сохраняет:

valid_words_full.jsonl — построчно,

valid_words_full.json — массив полных карточек,

valid_words_only.json — просто список слов,

wiktionary_cache.json — кэш запросов.

Ячейка 3 — «Проверка по сохранённым JSON»

Интерактив: вводишь слово → видишь три блока:

Stage-1 (сохранённые данные),

Финал (сохранённые данные),

«Живой прогон» через текущую validate_word из Ячейки 0.

Удобно для точечной диагностики расхождений.

Типовой порядок запуска

Установка зависимостей (если есть отдельная ячейка) → смонтировать Google Drive.

Ячейка 0 — загрузить логику/настройки, быстро проверить тестовые слова.

Ячейка 1 — собрать Stage-1 (с тестом позитивов) → valid_stage1.json.

Ячейка 2 — финальная валидация с Вики (с тестами) → финальные JSON.

(Опционально) Ячейка 3 — точечная проверка слов из сохранённых файлов.

После перезапуска среды достаточно снова выполнить зависимости + Ячейку 0, а затем сразу Ячейку 2 (если valid_stage1.json уже лежит на Диске).

Что и где на выходе

valid_stage1.json — кандидаты, прошедшие только pymorphy2 + ZipfΣ(e/ё).

valid_words_full.json — финальные карточки (включая поля: input, normalized, pymorphy_check, freq_check, wiktionary_check, zipf_form, zipf_lemma, final).

valid_words_only.json — список нормализованных слов (для игр/быстрых проверок).

wiktionary_cache.json — ускоряет повторные прогоны.

Тонкая настройка

Сделать строже/мягче: меняйте ZIPF_FREQ_THRESHOLD и/или FREQ_MODE.

Омонимия с прилагательными/причастиями: регулируйте AMBIGUITY_DELTA (↑ строже к ADJ-like).

Числительные: NUMR-вето (порог 0.15) — можно ослабить/усилить.

Е/Ё: включено всегда; частоты обеих орфографий агрегируются.

Белый список (редкие заимствования без словаря): можно добавить логику CUSTOM_NOUNS в Ячейку 0 (опционально).

Практические подсказки

Если финальный тест в Ячейке 2 падает из-за отсутствия позитивов — пересоберите Stage-1 (Ячейка 1) или синхронизируйте пороги/режимы с теми, что использовались при формировании valid_stage1.json.

Быстрые проверки делайте через Ячейку 3 (читает из файлов) или через validate_word(...) (онлайн-логика из Ячейки 0).